<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>English to Chinese - Name Generator</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
		
		<script>
			var chinesechars;
			var commonlastnames;
			$( document ).ready(function() {
				$.get("http://ccdb.hemiola.com/characters?fields=kMandarin,string&filter=gb+simplified", function(data, status){
					chinesechars = data;
					
					chinesechars.forEach(function(item){
						if(
						item.kMandarin == "MEI2" || 
						item.kMandarin == "LI4" || 
						item.kMandarin == "JIE2" || 
						item.kMandarin == "LING2" || 
						item.kMandarin == "AI4" || 
						item.kMandarin == "JING4" || 
						item.kMandarin == "HUA1" || 
						item.kMandarin == "YUE4"
						){
							item.gender = 'female';
						}
						else{
							item.gender = 'male';
						}
					});
				});
				
				commonlastnames = [
				{char:'王', pinyin:'wang'}, 
				{char:'李', pinyin:'li'}, 
				{char:'张', pinyin:'zhang'}, 
				{char:'陈', pinyin:'chen'}, 
				{char:'杨', pinyin:'yang'}, 
				{char:'黄', pinyin:'huang'}, 
				{char:'徐', pinyin:'xu'}, 
				{char:'孙', pinyin:'sun'}, 
				{char:'马', pinyin:'ma'}, 
				{char:'胡', pinyin:'hu'}, 
				{char:'郭', pinyin:'guo'}, 
				{char:'邓', pinyin:'deng'}, 
				{char:'彭', pinyin:'peng'}, 
				{char:'田', pinyin:'tian'}, 
				{char:'任', pinyin:'ren'}, 
				{char:'范', pinyin:'fan'}, 
				{char:'白', pinyin:'bai'}, 
				{char:'秦', pinyin:'qin'}, 
				{char:'孔', pinyin:'kong'}, 
				{char:'艾', pinyin:'ai'}, 
				{char:'倪', pinyin:'ni'}, 
				{char:'欧阳', pinyin:'ouyang'}, 
				{char:'蒋', pinyin:'jiang'}];
			});

			
			
			function btnClick(){
				var lastname = $('#lastnametxt').val();
				var firstname = $('#firstnametxt').val();
				var numcharstotal = $('#numcharsdropdown').val();
				var gender = $('#genderdropdown').val();
				
				var errors = "";
				if(lastname == null || lastname == undefined || lastname == ""){
					errors += 'Please enter a last name.\n';
				}
				if(firstname == null || firstname == undefined || firstname == ""){
					errors += 'Please enter a first name.\n';
				}
				if(errors != ""){
					$('#errors').text(errors);
					return;
				}
				
				
				var processedlastname = processLastName(lastname);
				var processedfirstname = processFirstName(firstname, numcharstotal, gender);
				$('#generatedname').text(processedlastname + processedfirstname);
			}
			
			function processLastName(lastname){
				var result = "";
				var firstletter = lastname[0];
				if(firstletter != null && firstletter != undefined){
					commonlastnames.forEach(function(item){
						if(item.pinyin[0].toLowerCase() == firstletter.toLowerCase()){
							result = item.char;
						}
					});
				}
				
				if(result == ""){
					result = commonlastnames[Math.floor(Math.random()*commonlastnames.length)].char;
				}
				
				return result;
			}
			
			function processFirstName(firstname, numcharstotal, gender){
				var result = "";
				var firstletter = firstname[0];
				
				var filteredsecondchars = [];
				var filteredthirdchars = [];
				
				var secondchar = "";
				var thirdchar = "";
				
				if(gender == "female"){
					chinesechars.forEach(function(item){
						if(item.kMandarin.toLowerCase()[0] == firstletter && item.gender == 'female'){
							filteredsecondchars.push(item);
						}
						if(item.gender == 'female'){
							filteredthirdchars.push(item);
						}
					});
				}
				else{
					chinesechars.forEach(function(item){
						if(item.kMandarin.toLowerCase()[0] == firstletter && item.gender == 'male'){
							filteredsecondchars.push(item);
							filteredthirdchars.push(item);
						}
					});
				}
				secondchar = filteredsecondchars[Math.floor(Math.random()*filteredsecondchars.length)].string;
				
				if(numcharstotal == 3){
					thirdchar = filteredthirdchars[Math.floor(Math.random()*filteredthirdchars.length)].string;
				}

				
				return secondchar + thirdchar;
			}
		</script>
		
	</head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<body>
	
	<table class="table table-bordered" style="text-align:center">
	<tr>
		<td>
		Last Name:
		</td>
		<td>
			<input id="lastnametxt"type="text" class="form-control"/>
		</td>
	</tr>
	
	<tr>
		<td>
		First Name:
		</td>
		<td>
			<input id="firstnametxt"type="text" class="form-control"/>
		</td>
	</tr>
	
	<tr>
		<td>
		Num chars total in Chinese name: 
		</td>
		<td>
		
		<select id='numcharsdropdown' class="form-control">
			<option value="2">Two</option>
			<option value="3">Three</option>
			<option value="4">Four</option>
		</select>
		
		</td>
	</tr>
	<tr>
		<td>
		Gender:
		</td>
		<td>
			<select id='genderdropdown' class="form-control">
			<option value="male">Male</option>
			<option value="female">Female</option>
			</select>
		</td>
	</tr>
	
	<tr>
		<td colspan="2">
		<button id="submitbtn" class="btn btn-primary" onclick="btnClick()">Generate</button>
		</td>
	</tr>
	<tr>
		<td colspan="2">
			<label id='generatedname'>
		</td>
	</tr>
	<tr>
		<td colspan="2">
			<label style="color:red" id='errors'>
		</td>
	</tr>
	</table>
</html>